#!/bin/bash

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RAG —Å–∏—Å—Ç–µ–º—ã —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –∫–ª–∏–Ω–∏–∫–∏"
echo "=================================================="

BASE_URL="http://localhost:3000"

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
test_query() {
    local question="$1"
    local test_name="$2"
    
    echo -e "\n${BLUE}–¢–µ—Å—Ç: ${test_name}${NC}"
    echo -e "${YELLOW}–í–æ–ø—Ä–æ—Å: ${question}${NC}"
    
    response=$(curl -s -X POST "${BASE_URL}/chat" \
        -H "Content-Type: application/json" \
        -d "{\"message\":\"${question}\"}")
    
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}‚úÖ –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω:${NC}"
        echo "$response" | jq -r '.reply' 2>/dev/null || echo "$response"
    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞${NC}"
    fi
    
    echo "----------------------------------------"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞..."
if curl -s "${BASE_URL}" > /dev/null; then
    echo -e "${GREEN}‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω${NC}"
else
    echo -e "${RED}‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ NestJS –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000${NC}"
    exit 1
fi

# –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
echo -e "\nüöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ..."

# –¢–µ—Å—Ç 1: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ü–µ–Ω–∞—Ö
test_query "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —á–∏—Å—Ç–∫–∞ –∑—É–±–æ–≤?" "–¶–µ–Ω—ã –Ω–∞ —É—Å–ª—É–≥–∏"

# –¢–µ—Å—Ç 2: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Ä–∞—á–∞—Ö
test_query "–ö—Ç–æ —Ç–∞–∫–æ–π –¥–æ–∫—Ç–æ—Ä –ù—É—Ä–º—É—Ö–∞–º–µ–¥–æ–≤?" "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Ä–∞—á–∞—Ö"

# –¢–µ—Å—Ç 3: –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
test_query "–ö–∞–∫–æ–π –∞–¥—Ä–µ—Å –∫–ª–∏–Ω–∏–∫–∏ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω?" "–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"

# –¢–µ—Å—Ç 4: –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã
test_query "–í –∫–∞–∫–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–ª–∏–Ω–∏–∫–∞?" "–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã"

# –¢–µ—Å—Ç 5: –£—Å–ª—É–≥–∏ –æ—Ä—Ç–æ–¥–æ–Ω—Ç–∏–∏
test_query "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ—è—Ç –±—Ä–µ–∫–µ—Ç—ã?" "–û—Ä—Ç–æ–¥–æ–Ω—Ç–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏"

# –¢–µ—Å—Ç 6: –í–æ–ø—Ä–æ—Å –Ω–µ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
test_query "–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ê—Å—Ç–∞–Ω–µ?" "–í–æ–ø—Ä–æ—Å –≤–Ω–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏"

# –¢–µ—Å—Ç 7: –°–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å
test_query "–ú–Ω–µ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –±—Ä–µ–∫–µ—Ç—ã. –ö –∫–∞–∫–æ–º—É –≤—Ä–∞—á—É –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∏ —Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å?" "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å"

echo -e "\n${GREEN}üéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!${NC}"
echo "–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:"
echo "1. –ó–∞–ø—É—â–µ–Ω –ª–∏ ChromaDB –Ω–∞ –ø–æ—Ä—Ç—É 8000"
echo "2. –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –ª–∏ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"
echo "3. –ù–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ OPENAI_API_KEY"